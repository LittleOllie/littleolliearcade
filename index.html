<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Little Ollie Arcade</title>

  <!-- PWA can stay -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#4c6fff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    *{ box-sizing:border-box; }
    :root{
      --bg1:#6de0ff;
      --bg2:#4c6fff;

      --shadow: 0 18px 44px rgba(0,0,0,.35);
      --soft: 0 10px 22px rgba(0,0,0,.25);

      --radius: 22px;
      --radius2: 16px;

      --accent: #ffdd55;
      --accentText: #161616;
      --trim: rgba(255,255,255,.14);

      --screen: rgba(0,0,0,.28);
      --screenBorder: rgba(255,255,255,.16);

      --panel: rgba(0,0,0,.18);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:18px 10px 28px;
      background: radial-gradient(circle at top, var(--bg1), var(--bg2));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color:#fff;
    }

    .wrap{ width: 980px; max-width: 96vw; }

    .panel{
      background: var(--panel);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }

    .header{
      width:100%;
      display:block;
      border-radius: 16px;
      box-shadow: var(--soft);
    }

    .statusbar{
      margin-top: 12px;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      font-weight: 900;
      letter-spacing: .2px;
      white-space:nowrap;
    }

    .pill small{
      opacity:.9;
      font-weight: 800;
      letter-spacing: .1px;
    }

    .btn{
      border:0;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 16px;
      background: var(--accent);
      color: var(--accentText);
      font-weight: 950;
      letter-spacing: .2px;
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
      transition: transform .08s ease, filter .12s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
    }
    .btn:hover{ filter: brightness(1.03); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn:disabled{ cursor:not-allowed; opacity:.65; transform:none; }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }

    .cabinet{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 16px 36px rgba(0,0,0,.28);
      overflow:hidden;
      position:relative;
      padding: 0;
    }

    .cabinet::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top, rgba(255,255,255,.10), transparent 55%);
      pointer-events:none;
    }

    .marquee{
      background: linear-gradient(180deg, rgba(0,0,0,.38), rgba(0,0,0,.18));
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }

    .marquee h3{
      margin:0;
      font-weight: 950;
      letter-spacing: .3px;
      font-size: 16px;
      text-transform: uppercase;
      display:flex;
      gap:10px;
      align-items:center;
    }

    .lights{
      display:inline-flex;
      gap:6px;
      transform: translateY(1px);
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.35);
      box-shadow: 0 0 0 2px rgba(0,0,0,.18) inset;
      opacity:.9;
    }

    .screen{
      margin: 12px;
      border-radius: var(--radius2);
      background: var(--screen);
      border: 1px solid var(--screenBorder);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.22);
      padding: 14px;
      min-height: 210px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      justify-content:space-between;
      position:relative;
      overflow:hidden;
    }

    .scanline{
      position:absolute;
      inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.06) 0px,
        rgba(255,255,255,.06) 1px,
        transparent 2px,
        transparent 6px
      );
      opacity:.12;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .screenTop{
      display:flex;
      gap: 12px;
      align-items:flex-start;
    }

    .emoji{
      font-size: 40px;
      line-height: 1;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
      flex: 0 0 auto;
    }

    .desc{
      margin:0;
      font-weight: 850;
      font-size: 13px;
      line-height: 1.35;
      opacity: .95;
    }

    .playBtn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      text-decoration:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 950;
      letter-spacing: .2px;
      background: var(--accent);
      color: var(--accentText);
      box-shadow: 0 12px 26px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      user-select:none;
      transition: transform .08s ease, filter .12s ease;
      font-size: 15px;
    }
    .playBtn:active{ transform: translateY(1px) scale(.99); }
    .playBtn:hover{ filter: brightness(1.02); }

    .controlsBar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }

    .joystick{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.28), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.18);
      position:relative;
    }
    .joystick::after{
      content:"";
      position:absolute;
      width: 12px;height:12px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      left: 9px; top: 9px;
      box-shadow: 0 8px 16px rgba(0,0,0,.25);
    }

    .buttons{ display:flex; gap:8px; align-items:center; }
    .btnDot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.20);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
    }
    .btnDot.a{ background: rgba(255, 80, 140, .55); }
    .btnDot.b{ background: rgba(124, 255, 199, .55); }
    .btnDot.c{ background: rgba(255, 221, 85, .55); }

    .foot{
      margin-top: 12px;
      opacity: .88;
      font-weight: 750;
      font-size: 12px;
      text-align:center;
    }

    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 14px;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(560px, 96vw);
      background: rgba(20,22,30,.96);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      padding: 14px;
    }
    .modal h2{
      margin: 0 0 6px;
      font-size: 20px;
      font-weight: 950;
      letter-spacing: .2px;
    }
    .modal p{
      margin: 0 0 10px;
      opacity: .93;
      font-weight: 750;
      line-height: 1.35;
      font-size: 13px;
    }
    .modal .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    .modal input{
      flex: 1 1 220px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      border-radius: 16px;
      padding: 11px 12px;
      outline:none;
      font-weight: 900;
    }
    .modal input::placeholder{ color: rgba(255,255,255,.7); }

    .modal .miniNote{
      margin-top: 10px;
      opacity:.9;
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 10px 12px;
      border-radius: 16px;
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Player modal -->
  <div class="overlay" id="playerOverlay" aria-hidden="true">
    <div class="modal">
      <h2>üëã Welcome to Little Ollie Arcade</h2>
      <p>
        Pick a player name so your scores can be saved on leaderboards.
        <br/>Or play as <b>Anon</b> (you can still play, but you <b>can‚Äôt submit scores</b>).
      </p>

      <div class="row">
        <input id="playerInput" maxlength="20" placeholder="Enter a name (1‚Äì20 chars)" />
        <button class="btn" id="savePlayerBtn">‚úÖ Save Name</button>
        <button class="btn" id="playAnonBtn">üòé Play as Anon</button>
      </div>

      <div class="miniNote">
        <b>FYI:</b> No password. Your name is stored on your device (browser) only.
        Incognito/private mode may not keep it after you close the window.
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <img class="header" src="header.png" alt="Little Ollie Arcade" />

      <div class="statusbar">
        <div class="pill">
          üë§ <span id="playerLabel">Player: ‚Äî</span>
          <small id="playerCanSubmit" style="margin-left:6px;">‚Äî</small>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="changeNameBtn">‚úèÔ∏è Change name</button>
        </div>
      </div>

      <div class="grid">
        <!-- Memory Game -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Memory Game
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>
            <div class="screenTop">
              <div class="emoji">üß†</div>
              <p class="desc">Flip cards and find matching pairs.</p>
            </div>
            <a class="playBtn" href="./memory-game/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>

        <!-- Row Match -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Row Match
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>
            <div class="screenTop">
              <div class="emoji">üß©</div>
              <p class="desc">Slide tiles to make each row match.</p>
            </div>
            <a class="playBtn" href="./row-match/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>

        <!-- Slider Puzzle -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Slider Puzzle
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>
            <div class="screenTop">
              <div class="emoji">üßä</div>
              <p class="desc">Slide tiles to rebuild the picture.</p>
            </div>
            <a class="playBtn" href="./slider-puzzle/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="foot">Little Ollie Arcade üéÆ</div>
    </div>
  </div>

  <script type="module">
    /******************************************************************
     * PLAYER (shared across ALL games)
     ******************************************************************/
    const LS_PLAYER_NAME = "lo_player_name_v1";
    const LS_PLAYER_ID   = "lo_player_id_v1";
    const LS_PLAYER_ANON_CHOICE = "lo_player_anon_choice_v1";
    // ‚úÖ NEW: Marks that the user has already been asked on the HUB
    const LS_PLAYER_ONBOARDED = "lo_player_onboarded_v1";

    const playerOverlay = document.getElementById("playerOverlay");
    const playerInput   = document.getElementById("playerInput");
    const savePlayerBtn = document.getElementById("savePlayerBtn");
    const playAnonBtn   = document.getElementById("playAnonBtn");
    const changeNameBtn = document.getElementById("changeNameBtn");

    const playerLabel   = document.getElementById("playerLabel");
    const playerCanSubmit = document.getElementById("playerCanSubmit");

    // ‚úÖ NEW: if user clicked PLAY before picking, we remember where to go
    let pendingNavUrl = null;

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function makeId(){
      if (crypto?.randomUUID) return crypto.randomUUID();
      return "p_" + Date.now() + "_" + Math.random().toString(16).slice(2);
    }

    function markOnboarded(){
      localStorage.setItem(LS_PLAYER_ONBOARDED, "1");
    }

    function isOnboarded(){
      return localStorage.getItem(LS_PLAYER_ONBOARDED) === "1";
    }

    function getPlayer(){
      const name = (localStorage.getItem(LS_PLAYER_NAME) || "").trim().slice(0,20);
      let id = (localStorage.getItem(LS_PLAYER_ID) || "").trim();
      if (!id) {
        id = makeId();
        localStorage.setItem(LS_PLAYER_ID, id);
      }
      const isAnon = !name;
      return { name, id, isAnon, canSubmit: !isAnon };
    }

    function setPlayerName(name){
      const clean = (name || "").trim().slice(0,20);
      if (clean) localStorage.setItem(LS_PLAYER_NAME, clean);
      else localStorage.removeItem(LS_PLAYER_NAME);
    }

    function setAnonChoice(flag){
      localStorage.setItem(LS_PLAYER_ANON_CHOICE, flag ? "1" : "0");
    }

    function updatePlayerUI(){
      const p = getPlayer();
      const shown = p.isAnon ? "Anon" : p.name;
      playerLabel.innerHTML = `Player: <b>${escapeHtml(shown)}</b>`;
      playerCanSubmit.textContent = p.canSubmit ? "‚úÖ Score submit ON" : "üö´ Score submit OFF";
    }

    function openPlayerModal(){
      playerOverlay.classList.add("show");
      playerOverlay.setAttribute("aria-hidden","false");
      playerInput.value = "";
      setTimeout(() => playerInput.focus(), 80);
    }

    function closePlayerModal(){
      playerOverlay.classList.remove("show");
      playerOverlay.setAttribute("aria-hidden","true");
    }

    function finishAndMaybeNavigate(){
      // ‚úÖ user has now made a choice on the hub
      markOnboarded();
      updatePlayerUI();
      closePlayerModal();

      // ‚úÖ if they clicked a game first, take them there now
      if (pendingNavUrl){
        const go = pendingNavUrl;
        pendingNavUrl = null;
        window.location.href = go;
      }
    }

    savePlayerBtn.addEventListener("click", () => {
      const name = (playerInput.value || "").trim();
      if(name.length < 1 || name.length > 20){
        alert("Name must be 1‚Äì20 characters.");
        return;
      }
      if(name.toLowerCase() === "anon" || name.toLowerCase() === "anonymous"){
        alert("Please pick a different name (not Anon).");
        return;
      }

      setPlayerName(name);
      setAnonChoice(false);
      finishAndMaybeNavigate();
    });

    playAnonBtn.addEventListener("click", () => {
      setPlayerName("");
      setAnonChoice(true);
      finishAndMaybeNavigate();
    });

    changeNameBtn.addEventListener("click", () => {
      // If they hit change name, we still consider them onboarded.
      openPlayerModal();
    });

    playerOverlay.addEventListener("click", (e) => {
      if(e.target === playerOverlay) {
        // If they were trying to go to a game, don't trap them forever:
        // just close and clear pending nav.
        pendingNavUrl = null;
        closePlayerModal();
      }
    });

    // ‚úÖ Gate PLAY buttons: hub is the only place that asks.
    function wirePlayGate(){
      const playLinks = Array.from(document.querySelectorAll("a.playBtn[href]"));
      playLinks.forEach(a => {
        a.addEventListener("click", (e) => {
          const href = a.getAttribute("href");
          if(!href) return;

          // if they've already chosen on the hub, go straight in
          if (isOnboarded()) return;

          // Otherwise: stop navigation, ask here, then go after they choose
          e.preventDefault();
          pendingNavUrl = href;
          openPlayerModal();
        });
      });
    }

    // ‚úÖ initial UI
    updatePlayerUI();

    // ‚úÖ if they already have a name OR chose anon before, mark onboarded so games shouldn't need to ask
    const hasName = !!(localStorage.getItem(LS_PLAYER_NAME) || "").trim();
    const choseAnonBefore = localStorage.getItem(LS_PLAYER_ANON_CHOICE) === "1";
    if (hasName || choseAnonBefore) markOnboarded();

    // ‚úÖ If not chosen yet, ask on the hub (but ONLY on the hub)
    if(!isOnboarded()){
      openPlayerModal();
    }

    wirePlayGate();

    // ‚úÖ This stays so games can read the player name/id consistently
    window.LO_ARCADE = { getPlayer };

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    }
  </script>
</body>
</html>

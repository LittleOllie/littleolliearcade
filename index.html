<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Little Ollie Arcade</title>

  <!-- PWA can stay -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#4c6fff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    *{ box-sizing:border-box; }
    :root{
      --bg1:#6de0ff;
      --bg2:#4c6fff;

      --shadow: 0 18px 44px rgba(0,0,0,.35);
      --soft: 0 10px 22px rgba(0,0,0,.25);

      --radius: 22px;
      --radius2: 16px;

      --accent: #ffdd55;          /* ‚úÖ Yellow everywhere */
      --accentText: #161616;
      --trim: rgba(255,255,255,.14);

      --screen: rgba(0,0,0,.28);
      --screenBorder: rgba(255,255,255,.16);

      --panel: rgba(0,0,0,.18);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:18px 10px 28px;
      background: radial-gradient(circle at top, var(--bg1), var(--bg2));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color:#fff;
    }

    .wrap{ width: 980px; max-width: 96vw; }

    .panel{
      background: var(--panel);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }

    .header{
      width:100%;
      display:block;
      border-radius: 16px;
      box-shadow: var(--soft);
    }

    /* ‚úÖ Top status bar */
    .statusbar{
      margin-top: 12px;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      font-weight: 900;
      letter-spacing: .2px;
      white-space:nowrap;
    }

    .pill small{
      opacity:.9;
      font-weight: 800;
      letter-spacing: .1px;
    }

    .btn{
      border:0;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 16px;
      background: var(--accent);      /* ‚úÖ Yellow */
      color: var(--accentText);
      font-weight: 950;
      letter-spacing: .2px;
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
      transition: transform .08s ease, filter .12s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
    }
    .btn:hover{ filter: brightness(1.03); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn:disabled{ cursor:not-allowed; opacity:.65; transform:none; }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Arcade cabinet card */
    .cabinet{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 16px 36px rgba(0,0,0,.28);
      overflow:hidden;
      position:relative;
      padding: 0;
    }

    .cabinet::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at top, rgba(255,255,255,.10), transparent 55%);
      pointer-events:none;
    }

    /* Top marquee */
    .marquee{
      background: linear-gradient(180deg, rgba(0,0,0,.38), rgba(0,0,0,.18));
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }

    .marquee h3{
      margin:0;
      font-weight: 950;
      letter-spacing: .3px;
      font-size: 16px;
      text-transform: uppercase;
      display:flex;
      gap:10px;
      align-items:center;
    }

    .lights{
      display:inline-flex;
      gap:6px;
      transform: translateY(1px);
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.35);
      box-shadow: 0 0 0 2px rgba(0,0,0,.18) inset;
      opacity:.9;
    }

    /* Screen */
    .screen{
      margin: 12px;
      border-radius: var(--radius2);
      background: var(--screen);
      border: 1px solid var(--screenBorder);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.22);
      padding: 14px;
      min-height: 210px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      justify-content:space-between;
      position:relative;
      overflow:hidden;
    }

    .scanline{
      position:absolute;
      inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.06) 0px,
        rgba(255,255,255,.06) 1px,
        transparent 2px,
        transparent 6px
      );
      opacity:.12;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .screenTop{
      display:flex;
      gap: 12px;
      align-items:flex-start;
    }

    .emoji{
      font-size: 40px;
      line-height: 1;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
      flex: 0 0 auto;
    }

    .desc{
      margin:0;
      font-weight: 850;
      font-size: 13px;
      line-height: 1.35;
      opacity: .95;
    }

    .playBtn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      text-decoration:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 950;
      letter-spacing: .2px;
      background: var(--accent);      /* ‚úÖ Yellow */
      color: var(--accentText);
      box-shadow: 0 12px 26px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      user-select:none;
      transition: transform .08s ease, filter .12s ease;
      font-size: 15px;
    }
    .playBtn:active{ transform: translateY(1px) scale(.99); }
    .playBtn:hover{ filter: brightness(1.02); }

    /* Bottom controls area (purely visual) */
    .controlsBar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }

    .joystick{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.28), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.18);
      position:relative;
    }
    .joystick::after{
      content:"";
      position:absolute;
      width: 12px;height:12px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      left: 9px; top: 9px;
      box-shadow: 0 8px 16px rgba(0,0,0,.25);
    }

    .buttons{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btnDot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.20);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
    }
    .btnDot.a{ background: rgba(255, 80, 140, .55); }
    .btnDot.b{ background: rgba(124, 255, 199, .55); }
    .btnDot.c{ background: rgba(255, 221, 85, .55); }

    .foot{
      margin-top: 12px;
      opacity: .88;
      font-weight: 750;
      font-size: 12px;
      text-align:center;
    }

    /* ‚úÖ Login modal */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 14px;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(560px, 96vw);
      background: rgba(20,22,30,.96);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      padding: 14px;
    }
    .modal h2{
      margin: 0 0 6px;
      font-size: 20px;
      font-weight: 950;
      letter-spacing: .2px;
    }
    .modal p{
      margin: 0 0 10px;
      opacity: .93;
      font-weight: 750;
      line-height: 1.35;
      font-size: 13px;
    }
    .modal .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    .modal input{
      flex: 1 1 220px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      border-radius: 16px;
      padding: 11px 12px;
      outline:none;
      font-weight: 900;
    }
    .modal input::placeholder{ color: rgba(255,255,255,.7); }

    .modal .miniNote{
      margin-top: 10px;
      opacity:.9;
      font-size: 12px;
      font-weight: 750;
      line-height: 1.35;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 10px 12px;
      border-radius: 16px;
    }

    .subtleLink{
      color: rgba(255,255,255,.92);
      text-decoration: underline;
      cursor:pointer;
      font-weight: 900;
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Player modal -->
  <div class="overlay" id="playerOverlay" aria-hidden="true">
    <div class="modal">
      <h2>üëã Welcome to Little Ollie Arcade</h2>
      <p>
        Pick a player name so your scores can be saved on leaderboards.
        <br/>Or play as <b>Anon</b> (you can still play, but you <b>can‚Äôt submit scores</b>).
      </p>

      <div class="row">
        <input id="playerInput" maxlength="20" placeholder="Enter a name (1‚Äì20 chars)" />
        <button class="btn" id="savePlayerBtn">‚úÖ Save Name</button>
        <button class="btn" id="playAnonBtn">üòé Play as Anon</button>
      </div>

      <div class="miniNote">
        <b>FYI:</b> No password. Your name is stored on your device (browser) only.
        You can change it anytime from the Arcade page.
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">

      <img class="header" src="header.png" alt="Little Ollie Arcade" />

      <!-- ‚úÖ Status bar (player + global plays) -->
      <div class="statusbar">
        <div class="pill">
          üë§ <span id="playerLabel">Player: ‚Äî</span>
          <small id="playerCanSubmit" style="margin-left:6px;">‚Äî</small>
        </div>

        <div class="pill">
          üéÆ Games played: <span id="playsLabel">‚Äî</span>
          <small id="playsStatus" style="margin-left:6px;">Loading‚Ä¶</small>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="changeNameBtn">‚úèÔ∏è Change name</button>
        </div>
      </div>

      <div class="grid">
        <!-- Memory Game -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Memory Game
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>

            <div class="screenTop">
              <div class="emoji">üß†</div>
              <p class="desc">Flip cards and find matching pairs.</p>
            </div>

            <a class="playBtn" href="./memory-game/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>

        <!-- Row Match -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Row Match
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>

            <div class="screenTop">
              <div class="emoji">üß©</div>
              <p class="desc">Slide tiles to make each row match.</p>
            </div>

            <a class="playBtn" href="./row-match/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>

        <!-- Slider Puzzle -->
        <div class="cabinet">
          <div class="marquee">
            <h3>
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
              Slider Puzzle
              <span class="lights">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
              </span>
            </h3>
          </div>

          <div class="screen">
            <div class="scanline"></div>

            <div class="screenTop">
              <div class="emoji">üßä</div>
              <p class="desc">Slide tiles to rebuild the picture.</p>
            </div>

            <a class="playBtn" href="./slider-puzzle/index.html">‚ñ∂Ô∏è PLAY</a>
          </div>

          <div class="controlsBar">
            <div class="joystick" aria-hidden="true"></div>
            <div class="buttons" aria-hidden="true">
              <div class="btnDot a"></div>
              <div class="btnDot b"></div>
              <div class="btnDot c"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="foot">Little Ollie Arcade üéÆ</div>
    </div>
  </div>

  <script type="module">
    /******************************************************************
     * PLAYER NAME (local only)
     ******************************************************************/
    const STORAGE_PLAYER = "lo_arcade_player_v1";
    const STORAGE_VISITED = "lo_arcade_visited_v1"; // used for "unique visits" if you want later

    const playerOverlay = document.getElementById("playerOverlay");
    const playerInput   = document.getElementById("playerInput");
    const savePlayerBtn = document.getElementById("savePlayerBtn");
    const playAnonBtn   = document.getElementById("playAnonBtn");
    const changeNameBtn = document.getElementById("changeNameBtn");

    const playerLabel   = document.getElementById("playerLabel");
    const playerCanSubmit = document.getElementById("playerCanSubmit");

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function getPlayer(){
      try{
        const raw = localStorage.getItem(STORAGE_PLAYER);
        if(!raw) return { name: "Anon", canSubmit: false };
        const obj = JSON.parse(raw);
        if(!obj || typeof obj.name !== "string") return { name: "Anon", canSubmit: false };
        const name = obj.name.trim().slice(0,20);
        const canSubmit = !!obj.canSubmit && name.toLowerCase() !== "anon";
        return { name: name || "Anon", canSubmit };
      }catch{
        return { name: "Anon", canSubmit: false };
      }
    }

    function setPlayer(name, canSubmit){
      const clean = String(name || "").trim().slice(0,20);
      const finalName = clean || "Anon";
      const finalCanSubmit = !!canSubmit && finalName.toLowerCase() !== "anon";
      localStorage.setItem(STORAGE_PLAYER, JSON.stringify({ name: finalName, canSubmit: finalCanSubmit }));
      updatePlayerUI();
    }

    function updatePlayerUI(){
      const p = getPlayer();
      playerLabel.innerHTML = `Player: <b>${escapeHtml(p.name)}</b>`;
      playerCanSubmit.textContent = p.canSubmit ? "‚úÖ Score submit ON" : "üö´ Score submit OFF";
    }

    function openPlayerModal(){
      playerOverlay.classList.add("show");
      playerOverlay.setAttribute("aria-hidden","false");
      playerInput.value = "";
      setTimeout(() => playerInput.focus(), 80);
    }

    function closePlayerModal(){
      playerOverlay.classList.remove("show");
      playerOverlay.setAttribute("aria-hidden","true");
    }

    savePlayerBtn.addEventListener("click", () => {
      const name = (playerInput.value || "").trim();
      if(name.length < 1 || name.length > 20){
        alert("Name must be 1‚Äì20 characters.");
        return;
      }
      if(name.toLowerCase() === "anon" || name.toLowerCase() === "anonymous"){
        alert("Please pick a different name (not Anon).");
        return;
      }
      setPlayer(name, true);
      closePlayerModal();
    });

    playAnonBtn.addEventListener("click", () => {
      setPlayer("Anon", false);
      closePlayerModal();
    });

    changeNameBtn.addEventListener("click", () => openPlayerModal());

    // Click outside modal closes
    playerOverlay.addEventListener("click", (e) => {
      if(e.target === playerOverlay) closePlayerModal();
    });

    // First load: if no player chosen, show modal
    updatePlayerUI();
    const existing = localStorage.getItem(STORAGE_PLAYER);
    if(!existing){
      openPlayerModal();
    }

    /******************************************************************
     * FIREBASE (GLOBAL "GAMES PLAYED" COUNTER)
     * Uses your Memory Game firebase project so you don't need a new one.
     ******************************************************************/
    const playsLabel  = document.getElementById("playsLabel");
    const playsStatus = document.getElementById("playsStatus");

    const firebaseConfig = {
      apiKey: "AIzaSyCpoXdJ1ASWEhp9IM4hm_LeVOW0VFqQ2hg",
      authDomain: "little-ollie-memory.firebaseapp.com",
      projectId: "little-ollie-memory",
      storageBucket: "little-ollie-memory.firebasestorage.app",
      messagingSenderId: "846792708520",
      appId: "1:846792708520:web:851cf20bf6a80754cd8d9d",
      measurementId: "G-CJCEBPSS2M"
    };

    let db = null;
    let onSnapshot, doc, getFirestore, initializeApp, setDoc, updateDoc, increment, serverTimestamp;

    try{
      ({ initializeApp } = await import("https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"));
      const fs = await import("https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js");
      ({ getFirestore, onSnapshot, doc, setDoc, updateDoc, increment, serverTimestamp } = fs);

      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    }catch(e){
      console.warn("Firebase failed on Arcade page:", e);
      playsLabel.textContent = "‚Äî";
      playsStatus.textContent = "Firebase not loading";
    }

    // Document that holds global stats
    const STATS_DOC_PATH = ["arcade_stats", "global"];

    async function ensureStatsDoc(){
      if(!db) return;
      const ref = doc(db, ...STATS_DOC_PATH);
      try{
        // Create if missing (safe)
        await setDoc(ref, {
          plays: 0,
          visitors: 0,
          updatedAt: serverTimestamp()
        }, { merge: true });
      }catch{}
    }

    async function markVisitorOnce(){
      // Optional: increments "visitors" once per browser
      if(!db) return;
      const ref = doc(db, ...STATS_DOC_PATH);

      const already = localStorage.getItem(STORAGE_VISITED) === "1";
      if(already) return;

      try{
        await updateDoc(ref, {
          visitors: increment(1),
          updatedAt: serverTimestamp()
        });
        localStorage.setItem(STORAGE_VISITED, "1");
      }catch{}
    }

    // ‚úÖ Expose a helper games can call later to increment plays
    // (You‚Äôll add ONE line in each game: window.LO_ARCADE?.trackPlay(); )
    async function trackPlay(){
      if(!db) return;
      const ref = doc(db, ...STATS_DOC_PATH);
      try{
        await updateDoc(ref, {
          plays: increment(1),
          updatedAt: serverTimestamp()
        });
      }catch(e){
        console.warn("trackPlay failed:", e);
      }
    }

    // Also expose player getter so games can use the same name automatically
    function getArcadePlayer(){
      return getPlayer(); // {name, canSubmit}
    }

    window.LO_ARCADE = {
      trackPlay,
      getPlayer: getArcadePlayer
    };

    // Live display of global plays
    async function startStatsListener(){
      if(!db) return;
      await ensureStatsDoc();
      await markVisitorOnce();

      const ref = doc(db, ...STATS_DOC_PATH);
      onSnapshot(ref, (snap) => {
        const d = snap.data() || {};
        const plays = Number.isFinite(d.plays) ? d.plays : 0;
        playsLabel.textContent = String(plays);
        playsStatus.textContent = "Live";
      }, (err) => {
        console.warn("Stats listener error:", err);
        playsStatus.textContent = "Stats error";
      });
    }

    startStatsListener();

    /******************************************************************
     * SERVICE WORKER (optional)
     ******************************************************************/
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    }
  </script>
</body>
</html>

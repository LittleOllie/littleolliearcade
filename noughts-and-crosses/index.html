<!DOCTYPE html>
<html lang="en">
<head>

<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  base-uri 'self';
  object-src 'none';
  frame-ancestors 'none';
  img-src 'self' data:;
  style-src 'self' 'unsafe-inline';
  script-src 'self' https://www.gstatic.com https://www.googleapis.com 'unsafe-inline';
  connect-src 'self' https://firestore.googleapis.com https://www.googleapis.com;
  upgrade-insecure-requests;
">
<meta http-equiv="Referrer-Policy" content="no-referrer">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">



  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Little Ollie Noughts & Crosses</title>

  <style>
    *{ box-sizing:border-box; }

    :root{
      --bg1:#6de0ff;
      --bg2:#4c6fff;

      --panel: rgba(0,0,0,.18);
      --panel2: rgba(0,0,0,.22);
      --shadow: 0 12px 28px rgba(0,0,0,.35);

      --yellow:#ffdd55;
      --yellow2:#ffd22e;
      --text:#ffffff;

      --radius: 18px;
      --gap: 10px;

      --tile: rgba(255,255,255,.18);
      --tileHover: rgba(255,255,255,.25);
      --tileBorder: rgba(255,255,255,.20);

      --winGlow: 0 0 22px rgba(255,221,85,.65), 0 0 40px rgba(255,221,85,.35);

      /* Neon glow colors */
      --xGlow: 0 0 10px rgba(109,224,255,.70), 0 0 22px rgba(109,224,255,.50), 0 0 42px rgba(109,224,255,.28);
      --oGlow: 0 0 10px rgba(255,221,85,.70), 0 0 22px rgba(255,221,85,.50), 0 0 42px rgba(255,221,85,.28);
      --surgeGlow: 0 0 16px rgba(255,221,85,.85), 0 0 40px rgba(255,221,85,.55), 0 0 70px rgba(255,221,85,.30);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:14px 10px 22px;
      background: radial-gradient(circle at top, var(--bg1), var(--bg2));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color:var(--text);
    }
.headerWrap{
  background: rgba(0,0,0,.12);          /* slight blue-ish panel tint like other pages */
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 18px;
  padding: 10px;
  margin: 0 auto 10px;
  box-shadow: var(--shadow);
}
.header{
  margin: 0;                             /* headerWrap controls spacing now */
  border-radius: 14px;
  box-shadow: none;                      /* avoid double shadow (wrap already has one) */
}

    .wrap{
      width: 980px;
      max-width: 96vw;
    }

    .header{
      width:100%;
      display:block;
      margin: 0 auto 10px;
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    .shell{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap: 12px;
      align-items:start;
    }

    .card{
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
    }

    /* LEFT: board area */
    .boardTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    /* We keep this container (so the layout stays identical),
       but we hide its contents as you requested earlier. */
    .titleLine{
      display:none;
    }

    .controls{
      display:flex;
      gap: 8px;
      flex-wrap: nowrap;          /* one line */
      justify-content:flex-start; /* all the way left */
      width:100%;
      align-items:center;
    }

.btn{
  appearance:none;
  border:0;
  cursor:pointer;
  background: var(--yellow);
  color:#222;
  font-weight: 900;
  padding: 12px 14px;        /* bigger */
  border-radius: 14px;       /* slightly rounder */
  box-shadow: 0 10px 20px rgba(0,0,0,.18);
  transition: transform .08s ease, filter .15s ease;
  font-size: 14px;           /* bigger */
  line-height:1;
  user-select:none;
  white-space:nowrap;
}
.btn:active{ transform: translateY(1px) scale(.99); }

.btn.secondary{
  background: rgba(255,255,255,.16);
  color: #fff;
  border: 1px solid rgba(255,255,255,.22);
  box-shadow:none;
  font-weight: 800;
}

/* keep .small, but make it match your other pages better */
.btn.small{
  padding: 11px 13px;
  font-size: 13.5px;
  border-radius: 13px;
}

    /* Push restart to the right, without affecting the other two */
    #restartBtn{ margin-left:0; }

    .select{
      background: var(--yellow);
      color:#222;
      border:0;
      border-radius: 13px;
      padding: 11px 13px;
      font-weight: 900;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
      cursor:pointer;
      font-size: 13.5px;
      line-height:1;
      outline:none;
      -webkit-appearance: none;
      appearance: none;
      white-space:nowrap;
    }

    .boardWrap{
      position: relative;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.10);
      border: 1px solid rgba(255,255,255,.16);
    }

    .boardLogo{
      position:absolute;
      inset: 10px;
      background: url("logo.png") center/contain no-repeat;
      opacity: .12;
      pointer-events:none;
      filter: saturate(1.1) contrast(1.05);
    }

    .board{
      position:relative;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      padding: 12px;
    }

    .tile{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      background: var(--tile);
      border: 1px solid var(--tileBorder);
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      transform: translateZ(0); /* keeps animations crisp */
    }
    .tile:hover{ background: var(--tileHover); }
    .tile:active{ transform: translateY(1px); }

    /* Fixed-size symbol so it NEVER changes tile size */
    .mark{
      display:block;
      width: 100%;
      text-align:center;
      font-weight: 1000;
      letter-spacing: 1px;
      font-size: clamp(44px, 8vw, 74px);
      line-height: 1;
      transform: translateY(1px);
      user-select:none;
      pointer-events:none;
      text-shadow: 0 8px 22px rgba(0,0,0,.30);
      will-change: transform, filter, text-shadow;
    }

    /* ‚úÖ Neon glow per player */
    .mark.x{
      text-shadow: var(--xGlow), 0 8px 22px rgba(0,0,0,.30);
      filter: saturate(1.05);
    }
    .mark.o{
      text-shadow: var(--oGlow), 0 8px 22px rgba(0,0,0,.30);
      filter: saturate(1.05);
    }

    /* ‚úÖ Pop-in animation */
    @keyframes popIn{
      0%   { transform: translateY(1px) scale(.72); filter: brightness(1.15); }
      55%  { transform: translateY(1px) scale(1.08); }
      100% { transform: translateY(1px) scale(1.00); filter: brightness(1); }
    }
    .mark.pop{
      animation: popIn 140ms ease-out;
    }

    .tile.disabled{
      cursor:default;
      filter: saturate(.95);
    }

    .tile.win{
      outline: 2px solid rgba(255,221,85,.65);
      box-shadow: var(--winGlow);
      background: rgba(255,221,85,.18);
    }

    /* ‚úÖ Win-line power surge */
    @keyframes surge{
      0%   { transform: scale(1); filter: brightness(1); }
      35%  { transform: scale(1.03); filter: brightness(1.35); }
      100% { transform: scale(1); filter: brightness(1); }
    }
    .tile.win{
      animation: surge 420ms ease-out;
    }
    .tile.win .mark{
      text-shadow: var(--surgeGlow), 0 10px 26px rgba(0,0,0,.35);
      filter: brightness(1.15);
    }

    .statusRow{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      margin-top: 10px;
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 10px 12px;
    }

    .statusText{
      font-weight: 900;
      font-size: 13px;
      letter-spacing:.2px;
      opacity:.98;
    }

    .pill{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.18);
      font-weight: 900;
      white-space:nowrap;
    }

    /* RIGHT: scores / mode */
    .sideTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .panelTitle{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }

    .modeRow{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }

    .toggle{
      flex:1;
      min-width: 140px;
    }

    .scoreBox{
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }

    .scoreRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      margin-bottom: 10px;
    }
    .scoreRow:last-child{ margin-bottom: 0; }

    .name{
      font-weight: 1000;
      font-size: 14px;
      opacity:.95;
      transition: color .15s ease, text-shadow .15s ease, filter .15s ease;
    }

    .score{
      font-weight: 1000;
      font-size: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.16);
      padding: 7px 10px;
      border-radius: 12px;
      min-width: 44px;
      text-align:center;
    }

    /* Active turn highlight */
    .activeTurn .name{
      color: var(--yellow2);
      text-shadow: 0 0 14px rgba(255,221,85,.55), 0 0 30px rgba(255,221,85,.22);
      filter: saturate(1.05);
    }

    .helper{
      margin-top: 10px;
      font-size: 12px;
      opacity:.92;
      line-height:1.35;
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
    }

    /* Mobile */
    @media (max-width: 860px){
      .shell{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
<div class="headerWrap">
  <img class="header" src="header.png" alt="Little Ollie Arcade Header" />
</div>

    <div class="shell">
      <!-- LEFT -->
      <div class="card">
        <div class="boardTop">
          <div class="titleLine">
            <h1>Noughts & Crosses</h1>
            <div class="sub">Pick a mode ‚Ä¢ Win = 3 in a row ‚Ä¢ New round starts automatically</div>
          </div>

          <div class="controls">
            <button class="btn small" id="arcadeBtn" type="button">üïπÔ∏è Arcade Menu</button>

            <select class="select" id="difficultySelect" title="Computer difficulty">
              <option value="easy">Difficulty - üü¢ Easy</option>
              <option value="medium" selected>Difficulty - üü° Medium</option>
              <option value="hard">Difficulty - üî¥ Hard</option>
            </select>

            <!-- ‚úÖ Restart is now yellow (removed "secondary") -->
            <button class="btn small" id="restartBtn" type="button">üîÅ Restart</button>
          </div>
        </div>

        <div class="boardWrap">
          <div class="boardLogo" aria-hidden="true"></div>
          <div class="board" id="board"></div>
        </div>

        <div class="statusRow">
          <div class="statusText" id="statusText">Choose a mode to start.</div>
          <div class="pill" id="starterPill">Starter: ‚Äî</div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="sideTop">
          <h2 class="panelTitle">Players</h2>
          <span class="pill" id="modePill">Mode: ‚Äî</span>
        </div>

        <div class="modeRow">
          <button class="btn toggle" id="modeComputer" type="button">Vs Computer</button>
          <button class="btn toggle secondary" id="modeTwoPlayer" type="button">2 Player</button>
        </div>

        <div class="scoreBox">
          <div class="scoreRow" id="p1Row">
            <div class="name" id="p1Name">Player 1 (X)</div>
            <div class="score" id="p1Score">0</div>
          </div>

          <div class="scoreRow" id="p2Row">
            <div class="name" id="p2Name">Player 2 (O)</div>
            <div class="score" id="p2Score">0</div>
          </div>

          <div class="scoreRow" id="drawRow">
            <div class="name">Draws ü§ù</div>
            <div class="score" id="drawScore">0</div>
          </div>
        </div>

        <div class="helper" id="helperText">
          Tip: In Computer mode, the starter alternates each round (you start, then computer starts, then you, etc.).
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------------------------
    // State
    // ---------------------------
    const boardEl = document.getElementById("board");
    const statusText = document.getElementById("statusText");
    const starterPill = document.getElementById("starterPill");

    const modePill = document.getElementById("modePill");
    const helperText = document.getElementById("helperText");

    const p1Row = document.getElementById("p1Row");
    const p2Row = document.getElementById("p2Row");
    const p1Name = document.getElementById("p1Name");
    const p2Name = document.getElementById("p2Name");
    const p1ScoreEl = document.getElementById("p1Score");
    const p2ScoreEl = document.getElementById("p2Score");

    // ‚úÖ Draws
    const drawScoreEl = document.getElementById("drawScore");
    let drawScore = 0;

    const modeComputerBtn = document.getElementById("modeComputer");
    const modeTwoPlayerBtn = document.getElementById("modeTwoPlayer");
    const restartBtn = document.getElementById("restartBtn");
    const arcadeBtn = document.getElementById("arcadeBtn");
    const difficultySelect = document.getElementById("difficultySelect");

    const WIN_LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let mode = "computer"; // "computer" or "two"
    let difficulty = "medium";

    let cells = Array(9).fill("");
    let current = "X";
    let locked = false;

    // Scores for this session
    let p1Score = 0;
    let p2Score = 0;

    // Alternating starter each round
    let nextStarter = "X";

    // ---------------------------
    // UI build
    // ---------------------------
    function buildBoard(){
      boardEl.innerHTML = "";
      for(let i=0;i<9;i++){
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.dataset.i = String(i);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.textContent = "";
        tile.appendChild(mark);

        tile.addEventListener("click", () => onTileClick(i));
        boardEl.appendChild(tile);
      }
    }

    function render(){
      const tiles = boardEl.querySelectorAll(".tile");
      tiles.forEach((t, i) => {
        const m = t.querySelector(".mark");
        const val = cells[i] || "";
        m.textContent = val;

        // keep mark classes consistent
        m.classList.remove("x","o","pop");
        if(val === "X") m.classList.add("x");
        if(val === "O") m.classList.add("o");

        t.classList.toggle("disabled", locked || !!cells[i]);
        t.classList.remove("win");
      });

      // Active glow on name
      p1Row.classList.toggle("activeTurn", current === "X" && !locked);
      p2Row.classList.toggle("activeTurn", current === "O" && !locked);

      p1ScoreEl.textContent = String(p1Score);
      p2ScoreEl.textContent = String(p2Score);
      drawScoreEl.textContent = String(drawScore);

      if(mode === "computer"){
        modePill.textContent = "Mode: Vs Computer";
        p1Name.textContent = "You (X)";
        p2Name.textContent = "Computer (O)";
        helperText.textContent = "Tip: Starter alternates each round (you start, then computer starts, then you, etc.).";
        difficultySelect.disabled = false;
        difficultySelect.style.opacity = "1";
      }else{
        modePill.textContent = "Mode: 2 Player";
        p1Name.textContent = "Player 1 (X)";
        p2Name.textContent = "Player 2 (O)";
        helperText.textContent = "Tip: Starter alternates each round (Player 1 starts, then Player 2 starts, etc.).";
        difficultySelect.disabled = true;
        difficultySelect.style.opacity = ".75";
      }

      starterPill.textContent = "Starter: " + (nextStarter === "X" ? "X" : "O");
    }

    // ---------------------------
    // Game logic
    // ---------------------------
    function setMode(newMode){
      mode = newMode;

      if(mode === "computer"){
        modeComputerBtn.classList.remove("secondary");
        modeTwoPlayerBtn.classList.add("secondary");
      }else{
        modeComputerBtn.classList.add("secondary");
        modeTwoPlayerBtn.classList.remove("secondary");
      }

      startNewRound(true);
    }

    function startNewRound(fromModeChange=false){
      cells = Array(9).fill("");
      locked = false;

      current = nextStarter;

      statusText.textContent = (mode === "computer")
        ? (current === "X" ? "Your turn (X)" : "Computer starts (O)")
        : (current === "X" ? "Player 1 turn (X)" : "Player 2 turn (O)");

      render();

      if(mode === "computer" && current === "O" && !fromModeChange){
        locked = true;
        render();
        setTimeout(() => {
          locked = false;
          computerMove();
        }, 250);
      }else if(mode === "computer" && current === "O" && fromModeChange){
        locked = false;
        computerMove();
      }
    }

    function fullRestart(){
      p1Score = 0;
      p2Score = 0;
      drawScore = 0;
      nextStarter = "X";
      startNewRound(false);
      render();
    }

    function onTileClick(i){
      if(locked) return;
      if(cells[i]) return;
      if(mode === "computer" && current === "O") return;

      placeMark(i, current);
      afterMove();
    }

    function placeMark(i, mark){
      cells[i] = mark;

      const tile = boardEl.querySelector(`.tile[data-i="${i}"]`);
      if(tile){
        const m = tile.querySelector(".mark");
        m.textContent = mark;

        // ‚úÖ Neon class per player
        m.classList.remove("x","o","pop");
        if(mark === "X") m.classList.add("x");
        if(mark === "O") m.classList.add("o");

        // ‚úÖ Pop-in animation (retrigger safely)
        void m.offsetWidth;     // force reflow
        m.classList.add("pop");

        tile.classList.add("disabled");
      }
    }

    function afterMove(){
      const win = getWinLine(cells);
      if(win){
        endRound(win);
        return;
      }

      if(isDraw(cells)){
        endRound(null);
        return;
      }

      current = (current === "X") ? "O" : "X";

      statusText.textContent = (mode === "computer")
        ? (current === "X" ? "Your turn (X)" : "Computer thinking‚Ä¶ (O)")
        : (current === "X" ? "Player 1 turn (X)" : "Player 2 turn (O)");

      render();

      if(mode === "computer" && current === "O"){
        locked = true;
        render();
        setTimeout(() => {
          locked = false;
          computerMove();
        }, 220);
      }
    }

    function endRound(winLine){
      locked = true;

      if(winLine){
        // ‚úÖ Win-line power surge (CSS animation on .tile.win)
        winLine.forEach(idx => {
          const tile = boardEl.querySelector(`.tile[data-i="${idx}"]`);
          if(tile){
            tile.classList.add("win");
            void tile.offsetWidth;
          }
        });

        const winner = cells[winLine[0]];

        if(winner === "X"){
          p1Score++;
          statusText.textContent = (mode === "computer") ? "You win! (X)" : "Player 1 wins! (X)";
        }else{
          p2Score++;
          statusText.textContent = (mode === "computer") ? "Computer wins! (O)" : "Player 2 wins! (O)";
        }
      }else{
        // ‚úÖ count draws
        drawScore++;
        statusText.textContent = "Draw! Nobody wins.";
      }

      nextStarter = (nextStarter === "X") ? "O" : "X";
      starterPill.textContent = "Starter: " + nextStarter;

      render();

      setTimeout(() => {
        startNewRound(false);
      }, 1000);
    }

    function getWinLine(b){
      for(const line of WIN_LINES){
        const [a,c,d] = line;
        if(b[a] && b[a] === b[c] && b[a] === b[d]) return line;
      }
      return null;
    }

    function isDraw(b){
      return b.every(x => x);
    }

    // ---------------------------
    // Computer AI (not always middle)
    // ---------------------------
    function computerMove(){
      if(locked) return;
      if(getWinLine(cells) || isDraw(cells)) return;

      const move = pickComputerMove(cells, difficulty);

      if(move == null){
        const idx = cells.findIndex(x => !x);
        if(idx >= 0) placeMark(idx, "O");
      }else{
        placeMark(move, "O");
      }

      afterMove();
    }

    function pickComputerMove(board, diff){
      const empties = [];
      for(let i=0;i<9;i++) if(!board[i]) empties.push(i);
      if(empties.length === 0) return null;

      if(diff === "easy"){
        const winMove = findWinningMove(board, "O");
        if(winMove != null && Math.random() < 0.25) return winMove;
        return empties[Math.floor(Math.random()*empties.length)];
      }

      if(diff === "medium"){
        const winMove = findWinningMove(board, "O");
        if(winMove != null) return winMove;

        const blockMove = findWinningMove(board, "X");
        if(blockMove != null) return blockMove;

        return weightedPick(board);
      }

      if(diff === "hard"){
        if(Math.random() < 0.20) return weightedPick(board);

        let bestScore = -Infinity;
        let bestMoves = [];
        for(const i of empties){
          board[i] = "O";
          const score = minimax(board, false, 0);
          board[i] = "";
          if(score > bestScore){
            bestScore = score;
            bestMoves = [i];
          }else if(score === bestScore){
            bestMoves.push(i);
          }
        }
        return bestMoves[Math.floor(Math.random()*bestMoves.length)];
      }

      return weightedPick(board);
    }

    function findWinningMove(board, who){
      for(let i=0;i<9;i++){
        if(board[i]) continue;
        board[i] = who;
        const win = getWinLine(board);
        board[i] = "";
        if(win) return i;
      }
      return null;
    }

    function weightedPick(board){
      const corners = [0,2,6,8].filter(i => !board[i]);
      const center = (!board[4]) ? [4] : [];
      const edges = [1,3,5,7].filter(i => !board[i]);

      const bag = [];
      corners.forEach(i => { bag.push(i,i,i); });
      center.forEach(i => { bag.push(i,i); });
      edges.forEach(i => { bag.push(i); });

      return bag[Math.floor(Math.random() * bag.length)];
    }

    function minimax(board, isMaximizing, depth){
      const win = getWinLine(board);
      if(win){
        const w = board[win[0]];
        if(w === "O") return 10 - depth;
        if(w === "X") return depth - 10;
      }
      if(isDraw(board)) return 0;

      const empties = [];
      for(let i=0;i<9;i++) if(!board[i]) empties.push(i);

      if(isMaximizing){
        let best = -Infinity;
        for(const i of empties){
          board[i] = "O";
          best = Math.max(best, minimax(board, false, depth+1));
          board[i] = "";
        }
        return best;
      }else{
        let best = Infinity;
        for(const i of empties){
          board[i] = "X";
          best = Math.min(best, minimax(board, true, depth+1));
          board[i] = "";
        }
        return best;
      }
    }

    // ---------------------------
    // Wiring
    // ---------------------------
    modeComputerBtn.addEventListener("click", () => setMode("computer"));
    modeTwoPlayerBtn.addEventListener("click", () => setMode("two"));

    difficultySelect.addEventListener("change", () => {
      difficulty = difficultySelect.value;
      render();
    });

    restartBtn.addEventListener("click", () => {
      fullRestart();
      statusText.textContent = "Restarted. New round!";
    });

    arcadeBtn.addEventListener("click", () => {
      // ‚úÖ This is the ONLY thing you might need to change:
      // If your hub is in the SAME folder, use "index.html"
      // If this game is inside a subfolder, "../index.html" is correct.
      window.location.href = "../index.html";
    });

    // Init
    buildBoard();
    setMode("computer");
    fullRestart();
  </script>
</body>
</html>
